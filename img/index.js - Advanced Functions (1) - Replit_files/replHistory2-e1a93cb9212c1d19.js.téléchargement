(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4487],{93061:function(e,n,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/replHistory2",function(){return r(98269)}])},11291:function(e,n,r){"use strict";r.d(n,{q:function(){return _},J:function(){return I}});var t=r(26042),i=r(99534),o=r(10253),l=r(35944),a=r(51438),u=r(28668),c=r(25171),s=r(78120),d=r(47421),f=r(52027),h=r.n(f),v=h().DIFF_DELETE,p=h().DIFF_INSERT,g=h().DIFF_EQUAL;function Z(e){return e.split("\n").length-1}function m(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(0===n)return 0;var t=e.indexOf("\n",r);return-1===t?null:1===n?t+1:m(e,n-1,t+1)}function w(e,n,r){if(e>0){var t=m(r,n);if(null!==t)return{lineNumber:n,character:t,padding:e}}return null}function y(e,n){for(var r,t,i=function(e,n){var r=new(h()),t=r.diff_linesToChars_(e,n),i=t.chars1,o=t.chars2,l=t.lineArray,a=r.diff_main(i,o,!1);return r.diff_charsToLines_(a,l),a}(e+((r="\n"===e[e.length-1])?"":"\n"),n+((t="\n"===n[n.length-1])?"":"\n")),l=0,a=0,u=[],c=[],s=[],d=[],f=0,m=0,y=0;y<i.length;y++){var x=(0,o.Z)(i[y],2),b=x[0],C=Z(x[1]);switch(b){case v:var E,R=(0,o.Z)(null!==(E=i[y+1])&&void 0!==E?E:[],2),P=R[0],k=R[1];l+=C;for(var S=0;S<C;S++)u.push(l-S);var L=C;P===p&&(L-=Z(k));var B=w(L,a,n);B&&d.push(B);break;case p:var G,T=(0,o.Z)(null!==(G=i[y-1])&&void 0!==G?G:[],2),X=T[0],U=T[1];a+=C;for(var I=0;I<C;I++)c.push(a-I);var _=C;X===v&&(_-=Z(U));var O=w(_,l,e);O&&s.push(O);break;case g:a>m&&(m=a),l>f&&(f=l),l+=C,a+=C}}var W=s.filter((function(e){return e.lineNumber<m})),D=d.filter((function(e){return e.lineNumber<f}));return{leftPadded:W,rightPadded:D,leftColored:u,rightColored:c,changedTrailingNewline:r!==t,leftTrailingNewline:r,rightTrailingNewline:t}}var x=d.tk.baseTheme({".cm-diff-inserted":{backgroundColor:"#0053A644",borderLeft:"#0053A6 solid 3px"},".cm-diff-deleted":{backgroundColor:"#c93c3733",borderLeft:"#c93c37 solid 3px"}}),b=d.p.line({attributes:{class:"cm-diff-inserted"}}),C=d.p.line({attributes:{class:"cm-diff-deleted"}}),E=s.Py.define({map:function(e,n){return e.map(n)}}),R=function(e){(0,u.Z)(r,e);var n=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),n.apply(this,arguments)}var t=r.prototype;return t.toDOM=function(){var e=document.createElement("div");return e.className="cm-diff-alignment cm-line",e.innerHTML="&nbsp;",e},t.ignoreEvent=function(){return!1},r}(d.l9);function P(e){var n=new s.f_,r=new R;e.sort((function(e,n){return e.character-n.character}));var t=!0,i=!1,o=void 0;try{for(var l,a=e[Symbol.iterator]();!(t=(l=a.next()).done);t=!0)for(var u=l.value,c=u.character,f=u.padding,h=0;h<f;h++)n.add(c,c,d.p.widget({widget:r,side:-1,block:!0}))}catch(v){i=!0,o=v}finally{try{t||null==a.return||a.return()}finally{if(i)throw o}}return n.finish()}function k(e){var n=e.coloredLines,r=e.colorDecoration,t=d.lg.fromClass((function e(t){(0,a.Z)(this,e);var i=new s.f_,o=!0,l=!1,u=void 0;try{for(var c,d=n[Symbol.iterator]();!(o=(c=d.next()).done);o=!0){var f=c.value,h=t.state.doc.line(f);i.add(h.from,h.from,r)}}catch(v){l=!0,u=v}finally{try{o||null==d.return||d.return()}finally{if(l)throw u}}this.decorations=i.finish()}),{decorations:function(e){return e.decorations}}),i=s.QQ.define({create:function(){return d.p.none},update:function(e,n){var r=!0,t=!1,i=void 0;try{for(var o,l=n.effects[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var a=o.value;if(a.is(E))return a.value}}catch(u){t=!0,i=u}finally{try{r||null==l.return||l.return()}finally{if(t)throw i}}return n.docChanged?e.map(n.changes):e},provide:function(e){return d.tk.decorations.from(e)}});return[x,t,i]}var S=function(){var e=function(e,n){return d.tk.domEventHandlers({scroll:function(r,t){if(t===e&&r.target){var i=r.target;if(i.scrollTop){var o=i.scrollTop;n.scrollDOM.scrollTo({top:o})}}}})},n=new s.F6,r=new s.F6;return{extensions:function(){return{right:n.of([]),left:r.of([])}},setup:function(t,i){t.dispatch({effects:r.reconfigure(e(t,i))}),i.dispatch({effects:n.reconfigure(e(i,t))})}}},L=r(67294),B=r(61134),G=r(78244),T=S(),X=T.extensions,U=T.setup;function I(e){var n=e.left,r=e.right,l=n.code,a=(0,i.Z)(n,["code"]),u=r.code,c=(0,i.Z)(r,["code"]),d=(0,B.Z)((0,t.Z)({readOnly:!0,lineWrapping:!1,initialDoc:l,extensions:[X().left]},a)),f=d.view,h=d.ref,v=(0,B.Z)((0,t.Z)({readOnly:!0,lineWrapping:!1,initialDoc:u,extensions:[X().right]},c)),p=v.view,g=v.ref,Z=(0,o.Z)(L.useState(!1),2),m=Z[0],w=Z[1],x=(0,o.Z)(L.useState(!1),2),R=x[0],S=x[1];return L.useEffect((function(){if(f&&p&&m&&R){var e=setTimeout((function(){U(f,p),function(e,n){var r=y(e.state.doc.sliceString(0),n.state.doc.sliceString(0));e.dispatch({effects:[s.Py.appendConfig.of(k({coloredLines:r.leftColored.sort((function(e,n){return e-n})),colorDecoration:C})),E.of(P(r.leftPadded))]}),n.dispatch({effects:[s.Py.appendConfig.of(k({coloredLines:r.rightColored.sort((function(e,n){return e-n})),colorDecoration:b})),E.of(P(r.rightPadded))]})}(f,p)}));return function(){return clearTimeout(e)}}}),[f,p,m,R]),L.useEffect((function(){f&&(f.dispatch({changes:{from:0,to:f.state.doc.length,insert:l}}),w(!0))}),[l,f]),L.useEffect((function(){p&&(p.dispatch({changes:{from:0,to:p.state.doc.length,insert:u}}),S(!0))}),[u,p]),{left:{view:f,ref:h,code:l,options:a,ready:m},right:{view:p,ref:g,code:u,options:c,ready:R}}}function _(e){var n,r=e.diffViewer,o=(0,i.Z)(e,["diffViewer"]);return(0,l.BX)(l.HY,{children:[(0,l.tZ)("div",{css:{height:r.ready?0:"auto"},ref:r.ref}),!r.ready&&(0,l.tZ)(G.P,(0,t.Z)({code:null!==(n=r.code)&&void 0!==n?n:""},r.options,o))]})}},74591:function(e,n,r){"use strict";var t=r(35944),i=(r(67294),r(69346)),o=r(1144),l=r(81255),a=r(65975),u=r(57704);n.Z=function(e){return(0,t.BX)(i.ZP,{css:[l.l0.colWithGap(24)],children:[(0,t.BX)(o.h,{variant:"headerDefault",level:2,children:["Delete ",e.name||e.entityType]}),(0,t.BX)(o.x,{multiline:!0,children:["Are you sure you want to delete this ",e.entityType,"? This cannot be undone."]}),(0,t.BX)(i.ZP,{css:[l.l0.rowWithGap(12),l.l0.justify.end],children:[(0,t.tZ)(a.zx,{text:"Cancel",onClick:e.hideModal}),(0,t.tZ)(a.zx,{dataCy:"delete-modal-confirm-button",iconLeft:(0,t.tZ)(u.Z,{}),onClick:function(){e.delete(),e.hideModal()},text:"Yes, delete this ".concat(e.entityType),colorway:"negative"})]})]})}},52008:function(e,n,r){"use strict";r.d(n,{JM:function(){return f},SL:function(){return s}});var t=r(26042),i=r(7297),o=r(31230),l=r(46829);function a(){var e=(0,i.Z)(['\n  fragment ReplEnvironment2CurrentUserLayoutFlags on CurrentUser {\n    id\n    flagSaveLayoutState: gate(feature: "flag-save-layout-state")\n    flagThreadsPane: gate(feature: "flag-threads-pane")\n    flagThreads2: gate(feature: "flag-threads-2")\n    flagGhostrunner: gate(feature: "flag-ghostrunner")\n  }\n']);return a=function(){return e},e}function u(){var e=(0,i.Z)(["\n  query ReplEnvironment2LayoutFlags {\n    currentUser {\n      id\n      ...ReplEnvironment2CurrentUserLayoutFlags\n    }\n  }\n  ","\n"]);return u=function(){return e},e}var c={},s=(0,o.ZP)(a()),d=(0,o.ZP)(u(),s);function f(e){var n=(0,t.Z)({},c,e);return l.useQuery(d,n)}},78539:function(e,n,r){"use strict";r.d(n,{Z:function(){return i}});var t=r(67294);function i(e){var n=e.children,r=(0,t.useState)(!0),i=r[0],o=r[1];return(0,t.useEffect)((function(){o(!1)}),[]),i?null:n}},90123:function(e,n,r){"use strict";r.d(n,{Z:function(){return s}});var t=r(47568),i=r(34051),o=r.n(i),l=r(67294),a=r(11163),u=r.n(a),c=r(25602);function s(e){var n=e.currentDeeplink,r=e.onChange,i=e.fs,a=e.enabled,s=(0,l.useRef)(!1);(0,l.useEffect)((function(){if(a){var e=function(){var e=(0,t.Z)(o().mark((function e(){var n,t,l,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!s.current){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,c.mv)(i);case 4:if(n=e.sent,t=n.path,l=n.line,a=n.col,t){e.next=11;break}return r(null),e.abrupt("return");case 11:r({path:t,line:l,col:a});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return window.addEventListener("hashchange",e),function(){window.removeEventListener("hashchange",e)}}}),[i,r,a]),(0,l.useEffect)((function(){if(a&&n){var e=(0,c.YM)(n),r=u().asPath;try{r=window.decodeURI(r)}catch(i){}if(!r.endsWith(e)){var t=u().asPath.includes("#")?u().asPath.slice(0,u().asPath.indexOf("#")):u().asPath;s.current=!0,u().push({pathname:u().pathname,query:u().query},"".concat(t).concat(e),{shallow:!0}),s.current=!1}}}),[i,n,a])}},54568:function(e,n,r){"use strict";r.d(n,{Z:function(){return c}});var t=r(26042),i=r(10253),o=r(67294),l=r(77402);function a(e,n){return(0,t.Z)({},e,n)}var u={isLoading:!1,result:null,error:null,fileViewerType:null};function c(e){var n=e.fs,r=e.path,t=(0,i.Z)(o.useReducer(a,u),2),c=t[0],s=t[1];return o.useEffect((function(){if(r){var e=!1,t=(0,l.V)(r);return s({isLoading:!0,fileViewerType:t}),n.readFile(r).then((function(n){e||(n.error?s({isLoading:!1,result:null,error:{path:r,fileViewerType:t,error:n.error}}):s({isLoading:!1,result:{path:r,fileViewerType:t,content:n.content},error:null}))})),function(){e=!0}}s(u)}),[n,r]),c}},54677:function(e,n,r){"use strict";r.d(n,{qC:function(){return s}});var t=r(26042),i=r(7297),o=r(31230),l=r(46829);function a(){var e=(0,i.Z)(["\n  query WorkspaceHeaderUsersOnline($ids: [Int!]!) {\n    currentUser {\n      id\n    }\n    usersByIds(ids: $ids) {\n      id\n      username\n      image\n    }\n  }\n"]);return a=function(){return e},e}var u={},c=(0,o.ZP)(a());function s(e){var n=(0,t.Z)({},u,e);return l.useQuery(c,n)}},43832:function(e,n,r){"use strict";r.d(n,{I$:function(){return w},Du:function(){return y},Cd:function(){return b}});var t=r(26042),i=r(7297),o=r(31230),l=r(9523),a=r(52008),u=r(65711),c=r(6695);function s(){var e=(0,i.Z)(["\n  fragment ReplEnvironmentHeaderLeftCurrentUser on CurrentUser {\n    id\n    isFirewallMode\n  }\n"]);return s=function(){return e},e}function d(){var e=(0,i.Z)(["\n  fragment ReplEnvironmentHeaderLeftRepl on Repl {\n    id\n    isAlwaysOn\n    slug\n    url\n    ...WorkspaceHeaderReplMetadataRepl\n  }\n  ","\n"]);return d=function(){return e},e}var f=(0,o.ZP)(s()),h=(0,o.ZP)(d(),c.s),v=r(46829);function p(){var e=(0,i.Z)(['\n  fragment ReplEnvironment2CurrentUser on CurrentUser {\n    id\n    image\n    isFirewallMode\n    ...CrosisContextCurrentUser\n    ...ReplEnvironment2CurrentUserLayoutFlags\n    editorPreferences {\n      ...CurrentUserPreferences\n    }\n    flagFiletreeSearch: gate(feature: "flag-filetree-search")\n    ...ReplEnvironmentHeaderLeftCurrentUser\n  }\n  ',"\n  ","\n  ","\n  ","\n"]);return p=function(){return e},e}function g(){var e=(0,i.Z)(["\n  fragment ReplEnvironment2Repl on Repl {\n    id\n    title\n    layoutState\n    description\n    multiplayers {\n      id\n    }\n    currentUserPermissions {\n      containerWrite\n    }\n    origin {\n      id\n    }\n    language\n    config {\n      isVnc\n      isServer\n    }\n    lesson {\n      id\n    }\n    ...CrosisContextRepl\n    ...ReplEnvironmentHeaderLeftRepl\n  }\n  ","\n  ","\n"]);return g=function(){return e},e}function Z(){var e=(0,i.Z)(["\n  query ReplEnvironment2($url: String!) {\n    repl(url: $url) {\n      ... on Repl {\n        id\n        ...CrosisContextRepl\n        ...ReplEnvironment2Repl\n      }\n      ... on ReplRedirect {\n        replUrl\n      }\n      ... on SubscriptionExpiredError {\n        replId\n        isOwner\n      }\n    }\n    currentUser {\n      id\n      ...ReplEnvironment2CurrentUser\n    }\n  }\n  ","\n  ","\n  ","\n"]);return Z=function(){return e},e}var m={},w=(0,o.ZP)(p(),l.D,a.SL,u.wO,f),y=(0,o.ZP)(g(),l.C,h),x=(0,o.ZP)(Z(),l.C,y,w);function b(e){var n=(0,t.Z)({},m,e);return v.useQuery(x,n)}},98269:function(e,n,r){"use strict";r.r(n),r.d(n,{default:function(){return _e}});var t=r(35944),i=r(51438),o=r(28668),l=r(26042),a=r(25171),u=r(99336),c=r(67294),s=r(22862),d=r(25108),f=function(e){(0,o.Z)(r,e);var n=(0,a.Z)(r);function r(){var e;return(0,i.Z)(this,r),(e=n.apply(this,arguments)).state={error:null,errorInfo:null,sentryId:null},e}var c=r.prototype;return c.componentDidCatch=function(e,n){var r,t,i=(0,u.ZP)(e,{tags:null!==(r=this.props.tags)&&void 0!==r?r:{},extras:(0,l.Z)({errorInfo:n},null!==(t=this.props.extras)&&void 0!==t?t:{})});this.setState({error:e,errorInfo:n,sentryId:i}),this.props.handleError&&this.props.handleError(e,n,i),d.error({error:e,errorInfo:n,sentryId:i})},c.render=function(){var e=this;return this.state.error?(0,t.tZ)(s.Z,{eventId:this.state.sentryId,devHide:function(){e.setState({error:null,errorInfo:null,id:null})}}):this.props.children},r}(c.Component),h=r(78738),v=r(93058),p=r(21131),g=r(45528),Z=r(2858),m=r(45589),w=r(92364),y=r(35621),x=r(7297),b=r(31230),C=r(9523),E=r(43832),R=r(46829);function P(){var e=(0,x.Z)(["\n  query ReplHistory2($url: String!) {\n    repl(url: $url) {\n      ... on Repl {\n        id\n        ...CrosisContextRepl\n        ...ReplEnvironment2Repl\n        currentUserPermissions {\n          containerWrite\n          viewHistory\n        }\n      }\n    }\n    currentUser {\n      id\n      ...ReplEnvironment2CurrentUser\n    }\n  }\n  ","\n  ","\n  ","\n"]);return P=function(){return e},e}var k={},S=(0,b.ZP)(P(),C.C,E.Du,E.I$);var L=r(11163),B=r(78539),G=r(47568),T=r(69396),X=r(99534),U=r(10253),I=r(34051),_=r.n(I),O=r(68368),W=r(96189),D=r(90123),N=r(65975),H=r(80380),A=r(99408),F=(0,r(70917).iv)("position:relative;overflow-y:auto;width:100%;height:100%;font-size:14px;background-color:var(--background-default);> div{display:flex;align-items:stretch;width:100%;height:100%;}> div > .cm-editor{flex:1 1 auto;width:100%;/* This ensures that .cm-editor doesn't overflow and handles horizontal scrolling internally */}");function V(e){var n=e.children;return(0,t.tZ)("div",{className:"editor",css:[F],children:n})}var M=r(11291);function q(e){var n=e.leftCode,r=e.rightCode,i=e.filePath,o=e.selectedVersion,l=(0,M.J)({left:{code:n,filePath:i},right:{code:r,filePath:i}}),a=l.left,u=l.right;return(0,t.BX)(N.G7,{css:[N.l0.rowWithGap(8),N.l0.flex.growAndShrink(1)],children:[(0,t.BX)(N.G7,{css:[N.l0.flex.growAndShrink(1),{flexBasis:0}],children:[(0,t.BX)(N.xv,{variant:"subheadDefault",css:[N.l0.pb(4)],children:["Version ",o]}),(0,t.tZ)(V,{children:(0,t.tZ)(M.q,{diffViewer:a})})]}),(0,t.BX)(N.G7,{css:[N.l0.flex.growAndShrink(1),{flexBasis:0}],children:[(0,t.tZ)(N.xv,{variant:"subheadDefault",css:[N.l0.pb(4)],children:"Latest Version"}),(0,t.tZ)(V,{children:(0,t.tZ)(M.q,{diffViewer:u})})]})]})}var Y=r(54568),J=r(58794),$=r(48551),z=r(63872);function Q(e){var n=e.content,r=e.mime;return n?(0,t.tZ)(z.A,{content:n,mime:r}):(0,t.tZ)(N.xv,{children:"No preview for this media file available."})}var j=r(47421),K=r(61134);function ee(e){var n=function(e,n,r){var t=(0,K.Z)({readOnly:!0,filePath:n}),i=t.view,o=t.ref;return(0,c.useEffect)((function(){i&&i.dispatch({changes:{from:0,to:i.state.doc.length,insert:e}})}),[i,e]),(0,c.useEffect)((function(){i&&r&&i.dispatch({effects:j.tk.scrollIntoView(r,{yMargin:10})})}),[i,r]),o}(e.content,e.filePath,e.scrollLocation);return(0,t.tZ)(V,{children:(0,t.tZ)("div",{ref:n})})}function ne(e){var n=e.media,r=e.comparison,i=e.scrubbable;return n?(0,t.tZ)("div",{css:[{width:"100%",height:"100%"},N.l0.textAlign.center],children:(0,t.tZ)(Q,(0,l.Z)({},n))}):r?(0,t.tZ)(q,(0,l.Z)({},r)):(0,t.tZ)(ee,(0,l.Z)({},i))}function re(e){var n=e.media,r=e.comparison,i=e.scrubbable;return(0,t.tZ)(f,{tags:{source:"replHistory2",type:"viewer-boundary"},extras:{mediaMime:null===n||void 0===n?void 0:n.mime,comparison:r,scrubbable:i},handleError:function(){window.location.hash=""},children:(0,t.tZ)(ne,{media:n,comparison:r,scrubbable:i})})}var te=r(26451),ie=r(519),oe=r(36555),le=r(25602),ae=r(61193),ue=r(54677),ce=r(23600),se=r(61957);function de(e){var n,r,i,o,l,a,u,c=e.selectedVersion,s=e.edits;return(null===window||void 0===window||null===(n=window.location)||void 0===n||null===(r=n.search)||void 0===r?void 0:r.includes("debug=1"))?(0,t.BX)(N.G7,{css:[N.l0.rowWithGap(16),N.l0.justify.start,N.l0.pt(16),N.l0.p(8),N.l0.mb(8),N.l0.backgroundColor.redDimmest,N.l0.font.code,N.l0.overflow("hidden"),N.l0.overflowX("auto")],children:[(0,t.BX)(N.G7,{children:[(0,t.tZ)("strong",{children:"Debug view"}),(0,t.BX)(N.G7,{children:["Current Version: ",c," / ",s.length]}),(0,t.BX)(N.G7,{children:["User ID: ",s[c-1].userId]}),(0,t.BX)(N.G7,{children:["Timestamp: ",s[c-1].timestamp]})]}),(0,t.BX)(N.G7,{css:[N.l0.flex.grow(1)],children:[(0,t.BX)(N.xv,{children:["Prev Op: ",null!==(a=JSON.stringify(null===(i=s[c-2])||void 0===i?void 0:i.op))&&void 0!==a?a:"N/A"]}),(0,t.BX)(N.xv,{css:[N.l0.pt(4),N.l0.pb(4)],children:["Current Op:",(0,t.tZ)("br",{})," ",JSON.stringify(null===(o=s[c-1])||void 0===o?void 0:o.op)]}),(0,t.BX)(N.xv,{children:["Next Op: ",null!==(u=JSON.stringify(null===(l=s[c])||void 0===l?void 0:l.op))&&void 0!==u?u:"N/A"]})]})]}):null}var fe=r(4275);function he(e){var n,r,i=(0,L.useRouter)().query,o=i.slug?i.slug.toString():null,a=i.username?i.username.toString():null;return(0,t.tZ)(N.ZP,(0,T.Z)((0,l.Z)({},e),{iconLeft:(0,t.tZ)(fe.Z,{}),text:null!==(n=e.text)&&void 0!==n?n:"Return to Workspace",href:"/@".concat(a,"/").concat(o)+(null!==(r=window.location.hash)&&void 0!==r?r:"")}))}var ve=r(29163),pe=r(75597);var ge=r(50522);function Ze(e){var n=e.isPlaying,r=e.onClick,i=n?pe.Pause:pe.Play,o=n?"Pause":"Play";return(0,t.tZ)(ve.Z,{onClick:r,alt:o,children:(0,t.tZ)(i,{})})}function me(e){var n=e.selectedVersion,r=e.edits,i=e.onChange,o=(0,ge.t)(n,i,r.length),l=o.isPlaying,a=o.start,u=o.stop,s=o.reset,d=function(e){l&&u();var t=Math.min(Math.max(n+e,1),r.length);i(t)};return function(e){var n=e.onLeft,r=e.onRight,t=e.onUp,i=e.onDown,o=function(e){var o=e.key;if("INPUT"!==e.target.tagName)switch(o){case"ArrowDown":i&&i();break;case"ArrowUp":t&&t();break;case"ArrowLeft":n&&n();break;case"ArrowRight":r&&r()}};c.useEffect((function(){return window.addEventListener("keydown",o),function(){window.removeEventListener("keydown",o)}}))}({onLeft:function(){d(-1)},onRight:function(){d(1)}}),1===r.length?(0,t.tZ)("p",{css:[N.l0.textAlign.center],children:"We don't have any explorable history for this file."}):(0,t.BX)(t.HY,{children:[(0,t.tZ)(Ze,{onClick:function(){l?u():(n===r.length&&s(),a())},isPlaying:l}),(0,t.tZ)("input",{css:N.l0.flex.grow(1),type:"range",min:"1",max:r.length,value:n,onChange:function(e){var n=e.currentTarget.value;u(),i(Number(n))}}),(0,t.BX)(N.xv,{css:[N.l0.maxWidth(100)],children:[n,"/",r.length]})]})}var we=r(34288),ye=function(e){var n=e.children;return(0,t.tZ)(N.G7,{css:[N.l0.flex.grow(2),N.l0.p(16),N.l0.center],children:n})};function xe(){return(0,t.tZ)(ye,{children:(0,t.tZ)(N.xv,{children:"No history found for this file."})})}function be(){return(0,t.BX)(ye,{children:[(0,t.tZ)(N.xv,{children:"Please select a file."}),(0,t.tZ)(N.xv,{children:"\ud83d\udc48 \ud83d\udc48 \ud83d\udc48 "})]})}function Ce(){return(0,t.tZ)(ye,{children:(0,t.tZ)(N.xv,{children:"Restoring and reloading."})})}function Ee(){return(0,t.tZ)(ye,{children:(0,t.tZ)(N.xv,{children:"Loading..."})})}function Re(){return(0,t.tZ)(N.G7,{css:[N.l0.height("100vh"),N.l0.center],children:(0,t.tZ)(N.G7,{css:[N.l0.maxWidth("400px")],children:(0,t.BX)(ye,{children:[(0,t.tZ)(N.xv,{multiline:!0,css:[N.l0.textAlign.center],children:"Something unexpected happened, maybe there's no Repl here or maybe you don't have access to it. You can try refreshing or use the navigation below."}),(0,t.BX)(N.G7,{css:[N.l0.p(16),N.l0.rowWithGap(8)],children:[(0,t.tZ)(N.ZP,{iconLeft:(0,t.tZ)(we.Z,{}),text:"Home",href:"/"}),(0,t.tZ)(he,{})]})]})})})}var Pe=r(86292),ke=r(53426),Se=function(e){(0,Pe.j)(Pe.U3.HISTORY_USED,{action:e,which:2})};function Le(e){var n=e.className,r=e.confirmTitle,i=e.confirmLabel,o=e.onConfirm,a=e.children,u=(0,X.Z)(e,["className","confirmTitle","confirmLabel","onConfirm","children"]),s=(0,c.useState)(!1),d=s[0],f=s[1];return(0,t.BX)(t.HY,{children:[(0,t.tZ)(N.u_,{isOpen:d,onRequestClose:function(){return f(!1)},children:(0,t.tZ)(O.Z,{onConfirm:function(){f(!1),o()},onCancel:function(){return f(!1)},title:r,confirmLabel:i,children:a})}),(0,t.tZ)(N.zx,(0,l.Z)({className:n,onClick:function(){return f(!0)}},u))]})}function Be(e){var n,r,i=e.edit,o=e.path,l=e.small,a=(0,ue.qC)({variables:{ids:[i.userId]},skip:!i.userId}).data;return(0,t.BX)(N.G7,{css:[N.l0.rowWithGap(16),N.l0.align.center,N.l0.pb(8)],children:[i.userId?(0,t.tZ)(N.n5,{src:(null===(n=null===a||void 0===a?void 0:a.usersByIds[0])||void 0===n?void 0:n.image)||null,username:(null===(r=null===a||void 0===a?void 0:a.usersByIds[0])||void 0===r?void 0:r.username)||"Loading user",localRole:l?void 0:"Author"}):(0,t.tZ)("div",{children:i.timestamp>ce.p?(0,t.tZ)(N.n5,{src:"/public/images/logo-modern-small.png",username:"Your Repl",localRole:l?void 0:"Server Authored"}):(0,t.tZ)(N.n5,{src:"/public/images/ghost.svg",username:"Unknown Author",localRole:void 0})}),(0,t.tZ)(N.xv,{children:(0,t.tZ)(H.Z,{dateFormat:"switch",date:i.timestamp})}),l?null:(0,t.tZ)(N.xv,{css:[N.l0.font.code],children:o})]})}function Ge(e){var n=e.filePath,r=e.small,i=(0,A.Z)().fs,o=(0,ae.c)("flag-rollout-history-2-diff-views"),l=o.enabled,a=o.loading,u=l&&!a,s=(0,c.useState)(!0),d=s[0],f=s[1],h=(0,c.useState)(!1),v=h[0],p=h[1],g=(0,c.useState)(null),Z=g[0],m=g[1],w=(0,c.useState)(""),y=w[0],x=w[1],b=(0,c.useState)({text:"",version:0}),C=b[0],E=b[1],R=(0,c.useState)(0),P=R[0],k=R[1],S=(0,c.useState)(0),L=S[0],B=S[1],T=function(e,n){var r=(0,Y.Z)({fs:e,path:n});if(r.result&&(0,$.T3)(r.result.path))return{content:J.Z.from(r.result.content).toString("base64"),mime:(0,$.yC)(r.result.path)}}(i,n),X=!r&&u,U=X&&v?{leftCode:C.text,rightCode:y,filePath:n,selectedVersion:P}:void 0,I={content:C.text,filePath:n,scrollLocation:L};(0,c.useEffect)((function(){f(!0);var e=i.watchOtFile(n,{onReady:function(){var e=(0,G.Z)(_().mark((function e(n){var r,t,i,o;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.fetchOps,t=n.version,i=n.initialContent,!(t<1)){e.next=8;break}return k(0),E({text:"",version:0}),x(""),m(null),f(!1),e.abrupt("return");case 8:return e.next=10,r(1,t);case 10:o=e.sent,k(t),E({text:i.toString(),version:t}),x(i.toString()),m((0,se.HJ)(o)),f(!1);case 16:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()});return function(){e(),m(null),f(!1)}}),[n,i]);var O=(0,c.useState)(!1),W=O[0],D=O[1],H=(0,c.useState)(null),F=H[0],V=H[1];function M(){return M=(0,G.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:D(!0),Se("versionRestored"),i.watchOtFile(n,{onReady:function(){var e=(0,G.Z)(_().mark((function e(n){var r,t,o,l,a;return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.writeOp,t=n.fetchOps,o=n.version,e.prev=1,e.next=4,t(1,o);case 4:if(l=e.sent,a=(0,se.HJ)(l)){e.next=8;break}throw new Error("Panic: received an instruction to restore with no edits to restore from.");case 8:return e.next=10,r((0,se.UK)(P,a),{isUnicode:!0});case 10:return e.next=12,i.flush();case 12:window.location.reload(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),D(!1),V(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(n){return e.apply(this,arguments)}}()});case 3:case"end":return e.stop()}}),e)}))),M.apply(this,arguments)}if(F)throw F;return W?(0,t.tZ)(Ce,{}):d?(0,t.tZ)(Ee,{}):Z?(0,t.BX)(N.G7,{css:{height:"100%",width:"100%"},children:[(0,t.BX)(N.G7,{css:[N.l0.pt(16),N.l0.colWithGap(8)],children:[(0,t.tZ)(N.G7,{css:[N.l0.rowWithGap(16),N.l0.justify.spaceBetween,N.l0.center,N.l0.pb(8)],children:(0,t.tZ)(me,{onChange:function(e){if(!Z)throw new Error("Received version change without any edits.");p(!1),k(e),E((function(n){var r=n.text,t=n.version,i=(0,se.ZK)(r,t,e,Z),o=i.content,l=i.location;return null!==l&&B(l),{text:o,version:e}}))},selectedVersion:P,edits:Z})}),T?null:(0,t.BX)(N.G7,{css:[N.l0.rowWithGap(16),N.l0.flex.wrap,N.l0.justify.spaceBetween],children:[(0,t.tZ)(Be,{small:r,path:n,edit:Z[P-1]}),(0,t.BX)(N.G7,{css:[N.l0.rowWithGap(8),r?N.l0.flex.grow(1):null],children:[X&&P!==Z.length?(0,t.BX)(N.G7,{css:[N.l0.height(32),N.l0.rowWithGap(8),N.l0.center],children:[(0,t.tZ)(N.xv,{children:"Compare"}),(0,t.tZ)(ie.Z,{isOn:v,onChange:function(){v||Se("diffPreviewed"),p((function(e){return!e}))}})]}):null,(0,t.tZ)(Le,{disabled:P===Z.length,text:"Restore to ".concat(P),css:r?[N.l0.flex.grow(1)]:[],onConfirm:function(){return M.apply(this,arguments)},confirmTitle:r?"Confirm restore?":"Are you sure you would like to restore?",confirmLabel:"Restore",children:(0,t.BX)(N.xv,{multiline:!0,children:["You can always restore back to the current version"," ",(0,t.tZ)(N.ZM,{children:Z.length}),"."]})})]})]}),(0,t.tZ)(N.G7,{children:(0,t.tZ)(de,{edits:Z,selectedVersion:P})})]}),(0,t.tZ)(re,{media:T,comparison:U,scrubbable:I})]}):(0,t.tZ)(xe,{})}var Te=(0,N.KD)("div");function Xe(){var e=(0,U.Z)(function(){var e=(0,A.Z)(),n=e.fs,r=e.session,t=(0,c.useState)(null),i=t[0],o=t[1];return(0,c.useEffect)((function(){var e=(0,le.mv)(n);(0,G.Z)(_().mark((function n(){var t;return _().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e;case 2:(t=n.sent).path&&(o(t.path),r.openFile(t.path));case 4:case"end":return n.stop()}}),n)})))()}),[n,r]),(0,D.Z)({fs:n,currentDeeplink:(0,c.useMemo)((function(){return i?{path:i}:void 0}),[i]),onChange:function(e){e&&o(e.path)},enabled:!0}),[i,o]}(),2),n=e[0],r=e[1],i=(0,c.useState)(!0),o=i[0],a=i[1],u=(0,c.useState)(!(0,le.u9)()),s=u[0],d=u[1],h=(0,W.Z)((function(e){void 0!==e.width&&(e.width<=500?a(!0):(a(!1),d(!0)))})),v=o?"100%":325,p=(0,ke.p)(),g=p.openFile,Z=c.useCallback((function(e,n){g(e,n),r(e),Se("fileSelected"),o&&d(!1)}),[r,o,g]),m=(0,T.Z)((0,l.Z)({},p),{openFile:Z});return(0,c.useEffect)((function(){Se("historyLoaded")}),[]),(0,t.tZ)(N.Tg,{children:(0,t.BX)(Te,{ref:function(e){h(e)},css:[N.l0.rowWithGap(8),{height:"100vh",width:"100vw"}],children:[(0,t.BX)(N.Tg,{elevated:!0,css:[N.l0.width(s?v:56),N.l0.p(8),o?{position:"fixed",zIndex:30,height:"100vh"}:null,{overflow:"hidden",transition:"width 180ms"}],children:[(0,t.BX)(N.G7,{css:s?[N.l0.rowWithGap(8),N.l0.justify.spaceBetween,N.l0.pb(8)]:[N.l0.colWithGap(8)],children:[o||!s?(0,t.tZ)(N.zx,{disabled:s&&null===n,iconLeft:(0,t.tZ)(te.Z,{}),text:s?"Hide files":"",onClick:function(){return d((function(e){return!e}))}}):null,(0,t.tZ)(he,{text:s?"Return to Workspace":"",colorway:"primary",css:N.l0.flex.grow(1)})]}),s?(0,t.tZ)(oe.Z,{readOnly:!0,showResources:!1,filetreeApi:m}):null]}),(0,t.tZ)(N.G7,{css:[N.l0.flex.growAndShrink(1),N.l0.pr(8),{height:"100vh"},N.l0.ml(o?64:0)],children:(0,t.tZ)(f,{tags:{source:"replHistory2",type:"inner-boundary"},extras:{activeFile:n,smallScreen:o,isFileTreeOpen:s},handleError:function(){r(""),window.location.hash=""},children:n?(0,t.tZ)(Ge,{small:o,filePath:n},n):(0,t.tZ)(be,{})})})]})})}var Ue=r(25108);function Ie(){var e,n=(0,L.useRouter)().query,r=n.slug?n.slug.toString():null;if(!r)throw new Error("Expected slug");var i=n.username?n.username.toString():function(){var e,n,r=null===window||void 0===window||null===(e=window.location)||void 0===e||null===(n=e.pathname)||void 0===n?void 0:n.split("/")[1];return r.startsWith("@")?r.substring(1):null}();if(!i)throw new Error("Expected username");var o=(0,v.Z)().showError,a=function(e){var n=(0,l.Z)({},k,e);return R.useQuery(S,n)}({variables:{url:"/@".concat(i,"/").concat(r)}}),u=a.data,s=a.loading,d=a.error,f=(0,c.useState)((function(){return(0,m.Z)({onUnrecoverableError:function(e){Ue.error(e),o("Unfortunately, something unexpected happened. You can try reloading or returning to the Workspace.")}})}))[0],x=(0,g.b)("Repl"===(null===u||void 0===u?void 0:u.repl.__typename)?{repl:u.repl,currentUser:u.currentUser||void 0}:null);(0,c.useEffect)((function(){x&&f.container.connect({context:x})}),[f,x]);var b=(0,p.Z)((function(){return!u||d||"Repl"!==u.repl.__typename?{id:"",language:""}:{id:u.repl.id,language:u.repl.language}}),[u,d]);return s?(0,t.tZ)(Ee,{}):!u||d||"Repl"!==u.repl.__typename?(0,t.tZ)(Re,{}):(null===(e=u.repl.currentUserPermissions)||void 0===e?void 0:e.containerWrite)?(0,t.tZ)(Z.Z.Provider,{value:f,children:(0,t.tZ)(y.Z.Provider,{value:b,children:(0,t.BX)(h.Z,{title:"History",marketingHeader:!1,noHeader:!0,noFooter:!0,hideSidebar:!0,hideEmailVerify:!0,children:[(0,t.tZ)(w.Z,{prefix:"History"}),(0,t.tZ)(Xe,{})]})})}):(0,t.tZ)(Re,{})}var _e=function(){return(0,t.tZ)(B.Z,{children:(0,t.tZ)(f,{tags:{source:"replHistory2",type:"outer-boundary"},children:(0,t.tZ)(Ie,{})})})}}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[3662,5762,8350,3443,2240,6344,1627,8764,6625,8966,4778,8003,9998,8944,8813,7485,5499,6165,1674,4508,2027,479,395,8738,4286,7046,2350,3497,3576,634,2385,6456,6602,9774,2888,179],(function(){return n(25436),n(93061)}));var r=e.O();_N_E=r}]);
//# sourceMappingURL=replHistory2-e1a93cb9212c1d19.js.map